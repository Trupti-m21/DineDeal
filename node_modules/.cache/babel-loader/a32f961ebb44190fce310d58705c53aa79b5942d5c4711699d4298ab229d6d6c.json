{"ast":null,"code":"// Constants for Google and Facebook OAuth\nconsole.log(\"login.js is loaded and executed\");const GOOGLE_CLIENT_ID=\"947375457765-3us6cvnqlg56dmi01bv64lqh0i47neur.apps.googleusercontent.com\";const FACEBOOK_APP_ID=\"542492095402931\";// Extract token from URL fragment\nfunction getAccessTokenFromUrl(){console.log(\"Extracting access token from URL...\");const hash=window.location.hash.substring(1);// Extract fragment part of the URL\nconst params=new URLSearchParams(hash);const token=params.get(\"access_token\");if(token){console.log(\"Access token found:\",token);window.history.replaceState(null,\"\",window.location.pathname+window.location.search);}else{console.log(\"No access token found in the URL.\");}return token;}// Fetch user info from the platform and update the UI\nfunction fetchUser(platform,token){console.log(`Fetching user info for platform: ${platform}`);const userInfoUrl=platform===\"google\"?`https://www.googleapis.com/oauth2/v2/userinfo?access_token=${token}`:`https://graph.facebook.com/me?access_token=${token}&fields=name`;fetch(userInfoUrl).then(response=>response.json()).then(data=>{console.log(\"User data fetched:\",data);const username=data.name||\"User\";localStorage.setItem(\"username\",username);console.log(\"Username stored in localStorage:\",username);window.location.href=\"index.html\";}).catch(error=>console.error(\"Error fetching user info:\",error));}// Store token securely in localStorage\nfunction storeToken(token,platform){console.log(`Storing token for platform: ${platform}`);const expiryTime=Date.now()+3600*1000;// Token validity (1 hour)\nlocalStorage.setItem(`${platform}_access_token`,JSON.stringify({token,expiryTime}));console.log(\"Token stored:\",token);}// Validate token stored in localStorage\nfunction validateToken(platform){console.log(`Validating token for platform: ${platform}`);const tokenData=JSON.parse(localStorage.getItem(`${platform}_access_token`));if(!tokenData||Date.now()>tokenData.expiryTime){console.warn(\"Token expired or invalid for platform:\",platform);localStorage.removeItem(`${platform}_access_token`);return null;}console.log(\"Token is valid for platform:\",platform);return tokenData.token;}// Display username on the main page (index.html)\nfunction displayUserOnHomePage(){console.log(\"Displaying user on the homepage...\");const username=localStorage.getItem(\"username\");const userGreeting=document.getElementById(\"userGreeting\");const loginButtonSection=document.getElementById(\"loginButtonSection\");const usernameElement=document.getElementById(\"username\");if(username){console.log(\"User is logged in:\",username);usernameElement.textContent=`Welcome, ${username}`;userGreeting.classList.remove(\"d-none\");loginButtonSection.classList.add(\"d-none\");console.log(localStorage.getItem(\"username\"));console.log(localStorage.getItem(\"google_access_token\"));console.log(localStorage.getItem(\"facebook_access_token\"));}else{console.log(\"No user is logged in.\");userGreeting.classList.add(\"d-none\");loginButtonSection.classList.remove(\"d-none\");}}// Logout functionality\nfunction setupLogout(){console.log(\"Setting up logout functionality...\");const logoutButton=document.getElementById(\"logoutButton\");if(logoutButton){logoutButton.addEventListener(\"click\",()=>{console.log(\"Logging out...\");localStorage.removeItem(\"username\");localStorage.removeItem(\"google_access_token\");localStorage.removeItem(\"facebook_access_token\");window.location.href=\"index.html\";});}}document.addEventListener(\"DOMContentLoaded\",()=>{console.log(\"Document loaded.\");if(window.location.pathname.includes(\"index.html\")){console.log(\"Handling homepage behavior...\");const googleToken=validateToken(\"google\");const facebookToken=validateToken(\"facebook\");if(googleToken||facebookToken){displayUserOnHomePage();}else{console.log(\"No valid token found.\");}setupLogout();// Handle location fetching\nif(navigator.geolocation){navigator.geolocation.getCurrentPosition(position=>{const{latitude,longitude}=position.coords;const locationElement=document.getElementById(\"currentLocation\");if(locationElement){locationElement.textContent=`Lat: ${latitude}, Long: ${longitude}`;}},error=>{console.error(\"Error fetching location:\",error);const locationElement=document.getElementById(\"currentLocation\");if(locationElement){locationElement.textContent=\"Unable to fetch location.\";}});}else{const locationElement=document.getElementById(\"currentLocation\");if(locationElement){locationElement.textContent=\"Geolocation not supported.\";}}// Attach listener to login button\nconst openLoginButton=document.getElementById(\"openLoginButton\");if(openLoginButton){openLoginButton.addEventListener(\"click\",()=>{console.log(\"Redirecting to login page...\");window.location.href=\"login.html\";// Navigate to login page\n});}else{console.warn(\"Login button not found.\");}}});","map":{"version":3,"names":["console","log","GOOGLE_CLIENT_ID","FACEBOOK_APP_ID","getAccessTokenFromUrl","hash","window","location","substring","params","URLSearchParams","token","get","history","replaceState","pathname","search","fetchUser","platform","userInfoUrl","fetch","then","response","json","data","username","name","localStorage","setItem","href","catch","error","storeToken","expiryTime","Date","now","JSON","stringify","validateToken","tokenData","parse","getItem","warn","removeItem","displayUserOnHomePage","userGreeting","document","getElementById","loginButtonSection","usernameElement","textContent","classList","remove","add","setupLogout","logoutButton","addEventListener","includes","googleToken","facebookToken","navigator","geolocation","getCurrentPosition","position","latitude","longitude","coords","locationElement","openLoginButton"],"sources":["C:/Users/trupt/DineDeals/src/login.js"],"sourcesContent":["// Constants for Google and Facebook OAuth\r\nconsole.log(\"login.js is loaded and executed\");\r\nconst GOOGLE_CLIENT_ID = \"947375457765-3us6cvnqlg56dmi01bv64lqh0i47neur.apps.googleusercontent.com\";\r\nconst FACEBOOK_APP_ID = \"542492095402931\";\r\n\r\n// Extract token from URL fragment\r\nfunction getAccessTokenFromUrl() {\r\n    console.log(\"Extracting access token from URL...\");\r\n    const hash = window.location.hash.substring(1); // Extract fragment part of the URL\r\n    const params = new URLSearchParams(hash);\r\n    const token = params.get(\"access_token\");\r\n\r\n    if (token) {\r\n        console.log(\"Access token found:\", token);\r\n        window.history.replaceState(null, \"\", window.location.pathname + window.location.search);\r\n    } else {\r\n        console.log(\"No access token found in the URL.\");\r\n    }\r\n    return token;\r\n}\r\n\r\n// Fetch user info from the platform and update the UI\r\nfunction fetchUser(platform, token) {\r\n    console.log(`Fetching user info for platform: ${platform}`);\r\n    const userInfoUrl =\r\n        platform === \"google\"\r\n            ? `https://www.googleapis.com/oauth2/v2/userinfo?access_token=${token}`\r\n            : `https://graph.facebook.com/me?access_token=${token}&fields=name`;\r\n\r\n    fetch(userInfoUrl)\r\n        .then((response) => response.json())\r\n        .then((data) => {\r\n            console.log(\"User data fetched:\", data);\r\n            const username = data.name || \"User\";\r\n            localStorage.setItem(\"username\", username);\r\n            console.log(\"Username stored in localStorage:\", username);\r\n\r\n            window.location.href = \"index.html\";\r\n        })\r\n        .catch((error) => console.error(\"Error fetching user info:\", error));\r\n}\r\n\r\n// Store token securely in localStorage\r\nfunction storeToken(token, platform) {\r\n    console.log(`Storing token for platform: ${platform}`);\r\n    const expiryTime = Date.now() + 3600 * 1000; // Token validity (1 hour)\r\n    localStorage.setItem(`${platform}_access_token`, JSON.stringify({ token, expiryTime }));\r\n    console.log(\"Token stored:\", token);\r\n}\r\n\r\n\r\n// Validate token stored in localStorage\r\nfunction validateToken(platform) {\r\n    console.log(`Validating token for platform: ${platform}`);\r\n    const tokenData = JSON.parse(localStorage.getItem(`${platform}_access_token`));\r\n    if (!tokenData || Date.now() > tokenData.expiryTime) {\r\n        console.warn(\"Token expired or invalid for platform:\", platform);\r\n        localStorage.removeItem(`${platform}_access_token`);\r\n        return null;\r\n    }\r\n    console.log(\"Token is valid for platform:\", platform);\r\n    return tokenData.token;\r\n}\r\n\r\n\r\n\r\n// Display username on the main page (index.html)\r\nfunction displayUserOnHomePage() {\r\n    console.log(\"Displaying user on the homepage...\");\r\n    const username = localStorage.getItem(\"username\");\r\n    const userGreeting = document.getElementById(\"userGreeting\");\r\n    const loginButtonSection = document.getElementById(\"loginButtonSection\");\r\n    const usernameElement = document.getElementById(\"username\");\r\n\r\n    if (username) {\r\n        console.log(\"User is logged in:\", username);\r\n        usernameElement.textContent = `Welcome, ${username}`;\r\n        userGreeting.classList.remove(\"d-none\");\r\n        loginButtonSection.classList.add(\"d-none\");\r\n        console.log(localStorage.getItem(\"username\"));\r\n        console.log(localStorage.getItem(\"google_access_token\"));\r\n        console.log(localStorage.getItem(\"facebook_access_token\"));\r\n\r\n    } else {\r\n        console.log(\"No user is logged in.\");\r\n        userGreeting.classList.add(\"d-none\");\r\n        loginButtonSection.classList.remove(\"d-none\");\r\n    }\r\n}\r\n\r\n// Logout functionality\r\nfunction setupLogout() {\r\n    console.log(\"Setting up logout functionality...\");\r\n    const logoutButton = document.getElementById(\"logoutButton\");\r\n    if (logoutButton) {\r\n        logoutButton.addEventListener(\"click\", () => {\r\n            console.log(\"Logging out...\");\r\n            localStorage.removeItem(\"username\");\r\n            localStorage.removeItem(\"google_access_token\");\r\n            localStorage.removeItem(\"facebook_access_token\");\r\n            window.location.href = \"index.html\";\r\n        });\r\n    }\r\n}\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\", () => {\r\n    console.log(\"Document loaded.\");\r\n  \r\n    if (window.location.pathname.includes(\"index.html\")) {\r\n      console.log(\"Handling homepage behavior...\");\r\n  \r\n      const googleToken = validateToken(\"google\");\r\n      const facebookToken = validateToken(\"facebook\");\r\n  \r\n      if (googleToken || facebookToken) {\r\n        displayUserOnHomePage();\r\n      } else {\r\n        console.log(\"No valid token found.\");\r\n      }\r\n  \r\n      setupLogout();\r\n  \r\n      // Handle location fetching\r\n      if (navigator.geolocation) {\r\n        navigator.geolocation.getCurrentPosition(\r\n          (position) => {\r\n            const { latitude, longitude } = position.coords;\r\n            const locationElement = document.getElementById(\"currentLocation\");\r\n            if (locationElement) {\r\n              locationElement.textContent = `Lat: ${latitude}, Long: ${longitude}`;\r\n            }\r\n          },\r\n          (error) => {\r\n            console.error(\"Error fetching location:\", error);\r\n            const locationElement = document.getElementById(\"currentLocation\");\r\n            if (locationElement) {\r\n              locationElement.textContent = \"Unable to fetch location.\";\r\n            }\r\n          }\r\n        );\r\n      } else {\r\n        const locationElement = document.getElementById(\"currentLocation\");\r\n        if (locationElement) {\r\n          locationElement.textContent = \"Geolocation not supported.\";\r\n        }\r\n      }\r\n  \r\n      // Attach listener to login button\r\n      const openLoginButton = document.getElementById(\"openLoginButton\");\r\n      if (openLoginButton) {\r\n        openLoginButton.addEventListener(\"click\", () => {\r\n          console.log(\"Redirecting to login page...\");\r\n          window.location.href = \"login.html\"; // Navigate to login page\r\n        });\r\n      } else {\r\n        console.warn(\"Login button not found.\");\r\n      }\r\n    }\r\n  });\r\n  "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}