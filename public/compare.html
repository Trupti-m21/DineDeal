<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dine Deal | Explore your food options</title>

    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="180x180" href="assets/img/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/img/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/img/favicons/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <link rel="shortcut icon" type="image/x-icon" href="assets/img/favicons/favicon.ico">
    <link rel="manifest" href="assets/img/favicons/manifest.json">
    <meta name="msapplication-TileImage" content="assets/img/favicons/mstile-150x150.png">
    <meta name="theme-color" content="#ffffff">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Stylesheets -->
    <link href="assets/css/theme.css" rel="stylesheet" />
    <link href="assets/css/compare_style.css" rel="stylesheet" />
   <!--  <style> 
        /* General Styles */
body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background-color: #f9f9f9;
}
//commit the changes
/* Sidebar (Filter Section) */
.filter {
    width: 280px;
    background-color: #ffffff;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    margin-right: 20px;
    margin-bottom: 20px;
}

.filter h2 {
    font-size: 20px;
    color: #333;
    margin-bottom: 15px;
}

.filter label {
    font-size: 14px;
    color: #555;
    margin-bottom: 8px;
    display: block;
}

.filter select,
.filter input[type="number"],
.filter input[type="range"] {
    width: calc(100% - 20px);
    padding: 10px;
    margin: 10px 0;
    border: 1px solid #ddd;
    border-radius: 5px;
    transition: border-color 0.3s ease;
}

.filter select:hover,
.filter input[type="number"]:hover,
.filter input[type="range"]:hover {
    border-color: #ff6600;
}

.filter .sort-by {
    margin-bottom: 20px;
}

/* Product List Section */
.product-list {
    display: flex;
    flex-direction: column;
    flex-grow: 1;
    padding: 20px;
    background-color: #f9f9f9;
}

.product-list #productList {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.card {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    height: auto;
    background-color: #fff;
    border: 1px solid #ddd;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    padding: 15px;
    overflow: hidden;
}

.card .card-body {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
}

.card .text-section {
    flex: 1;
    margin-right: 10px;
}

.card .card-title {
    font-size: 18px;
    font-weight: bold;
    margin-bottom: 5px;
    color: #333;
}

.card .card-text {
    font-size: 14px;
    color: #555;
    margin-bottom: 10px;
}

.card .price-section {
    font-size: 16px;
    font-weight: bold;
    color: #ff6600;
}

/* Layout for Sidebar and Product List */
.compare-structure {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    padding: 20px;
    gap: 20px;
}

.sidebar-price {
    flex: 0 0 280px;
}

.product-list {
    flex: 1;
    max-width: calc(100% - 320px);
}

/* Responsive Design */
@media (max-width: 768px) {
    .compare-structure {
        flex-direction: column;
    }

    .sidebar-price {
        flex: 1;
    }

    .product-list {
        max-width: 100%;
    }
}


    </style> -->
    <style>
        body {
                 font-family: Arial, sans-serif;
                 margin: 0;
                 padding: 0;
                 background-color: #f5f5f5;
             }
             
             .container {
                 display: flex;
                 padding: 20px;
             }
             .filter {
                 width: 300px;
                
                 background-color: #fff;
                 padding: 20px;
                 border-radius: 8px;
                 box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                 margin-right: 20px;
             }
             .filter h2 {
                 font-size: 24px;
                 color: #ff6600;
                 margin-bottom: 20px;
             }
             .filter label {
                 font-size: 16px;
                 color: #666;
                 display: block;
                 margin-bottom: 10px;
             }
             .filter input[type="range"] {
                 width: 100%;
                 margin-bottom: 20px;
             }
             .filter input[type="number"] {
                 width: 100%;
                 padding: 5px;
                 font-size: 16px;
                 border: 1px solid #ccc;
                 border-radius: 4px;
                 margin-bottom: 20px;
             }
             .filter .sort-by {
                 margin-bottom: 20px;
             }
             .filter .sort-by label {
                 font-size: 16px;
                 color: #666;
                 display: block;
                 margin-bottom: 10px;
             }
             .filter .sort-by select {
                 width: 100%;
                 padding: 5px;
                 font-size: 16px;
                 border: 1px solid #ccc;
                 border-radius: 4px;
             }
           
                 .filter .restaurant-by {
                 margin-bottom: 20px;
             }
             .filter .restaurant-by label {
                 font-size: 16px;
                 color: #666;
                 display: block;
                 margin-bottom: 10px;
             }
             .filter .restaurant-by select {
                 width: 100%;
                 padding: 5px;
                 font-size: 16px;
                 border: 1px solid #ccc;
                 border-radius: 4px;
             }

             .results {
                 flex: 1;
             }
             .result-item {
                 background-color: #fff;
                 padding: 20px;
                 border-radius: 8px;
                 box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                 margin-bottom: 20px;
                 display: flex;
                 justify-content: space-between;
                 align-items: center;
             }
             .result-item h3 {
                 font-size: 20px;
                 margin: 0;
                 color: #333;
             }
             .result-item p {
                 font-size: 14px;
                 color: #666;
                 margin: 5px 0;
             }
             .result-item .price {
                 font-size: 18px;
                 font-weight: bold;
                 color: #4CAF50;
             }
             /* General styles for inputs and select elements */
input, select {
    width: 100%; /* Makes them the same width */
    padding: 10px; /* Add spacing inside */
    font-size: 16px; /* Ensure consistent font size */
    margin-bottom: 10px; /* Add space between elements */
    border: 1px solid #ccc; /* Standard border style */
    border-radius: 4px; /* Smooth corners */
    box-sizing: border-box; /* Ensure padding doesn't affect width */
}

/* Specific styles for the restaurant dropdown */
.styled-select {
    background-color: #fff; /* White background for better contrast */
    appearance: none; /* Remove browser-specific styling */
    -moz-appearance: none; /* Firefox */
    -webkit-appearance: none; /* Chrome/Safari */
    cursor: pointer;
}

/* Optional: Align labels consistently */
label {
    display: block;
    font-weight: bold;
    margin-bottom: 5px; /* Add space between label and input */
}

       </style>

</head>

<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
        <div class="container">
            <a class="navbar-brand d-inline-flex" href="index.html"><img class="d-inline-block" src="assets/img/gallery/logo.svg" alt="logo" /><span class="text-1000 fs-3 fw-bold ms-2 text-gradient">DineDeal</span></a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"> </span></button>
            <div class="collapse navbar-collapse border-top border-lg-0 my-2 mt-lg-0" id="navbarSupportedContent">
                <div class="mx-auto pt-5 pt-lg-0 d-block d-lg-none d-xl-block">
                    <p class="mb-0 fw-bold text-lg-center"><i class="fas fa-map-marker-alt text-warning mx-2"></i><span id="currentLocation">Fetching location...</span></p>
                </div>
                <script>

                document.addEventListener("DOMContentLoaded", () => {
                console.log("Document loaded.");

                        // Fetch and display location
                    const fetchAndDisplayLocation = (latitude, longitude) => {
                  const locationElement = document.getElementById("currentLocation");
            
                  if (latitude && longitude) {
                    const geocodeUrl = `https://nominatim.openstreetmap.org/reverse?lat=${latitude}&lon=${longitude}&format=json`;
            
                    fetch(geocodeUrl)
                      .then((response) => response.json())
                      .then((data) => {
                        if (data && data.display_name) {
                          const locationParts = data.display_name.split(", ");
                          const city = locationParts[1]; // Extract "Malindi"
                          const country = locationParts[locationParts.length - 1]; // Extract "Kenya"
                          locationElement.textContent = `Current Location: ${city}, ${country}`;
                        } else {
                          locationElement.textContent = "Location not found.";
                        }
                      })
                      .catch((error) => {
                        console.error("Error fetching location:", error);
                        locationElement.textContent = "Unable to fetch location.";
                      });
                  } else {
                    locationElement.textContent = "Coordinates not available.";
                  }
                };
            
                // Get coordinates using Geolocation API
                const getCoordinates = () => {
                  if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                      (position) => {
                        const { latitude, longitude } = position.coords;
                        console.log(`Coordinates: Lat ${latitude}, Long ${longitude}`);
                        fetchAndDisplayLocation(latitude, longitude);
                      },
                      (error) => {
                        console.error("Error fetching coordinates:", error);
                        const locationElement = document.getElementById("currentLocation");
                        locationElement.textContent = "Unable to fetch coordinates.";
                      }
                    );
                  } else {
                    console.log("Geolocation not supported.");
                    const locationElement = document.getElementById("currentLocation");
                    locationElement.textContent = "Geolocation not supported.";
                  }
                };

                getCoordinates();

            }); 

                </script>
                <form class="d-flex mt-4 mt-lg-0 ms-lg-auto ms-xl-0">
                    <div class="input-group-icon pe-2"><i class="fas fa-search input-box-icon text-primary"></i>
                        <input class="form-control border-0 input-box bg-100" style="width: 300px;" type="search" placeholder="Let's find the perfect meal!" aria-label="Search" id="search-term" />
                    </div>
                    <button type="button" class="btn btn-warning" onclick="searchFood(event)">Search</button>
                </form>
            </div>
        </div>
    </nav>
    

    <!--product list Side Bar-->

    <div class="compare-structure">
        <div class="sidebar-price">
            <div class="container">
                <div class="filter">
                    <div class="sort-by">
                        <p></p>
                        <h2 for="sort-by">Sort by</h2>
                        <select id="sort-by" class="styled-select">
                            <option value="low-to-high">Low to High</option>
                            <option value="high-to-low">High to Low</option>
                        </select>
                    </div>
                    <h2>Price Range</h2>
                    <label for="min-price">Minimum Price</label>
                    <input id="min-price" type="number" value="0" />
                    <label for="max-price">Maximum Price</label>
                    <input id="max-price" type="number" value="100" />
    
                    <h2 for="restaurant">Restaurant</h2>
                    <label for="restaurant">Select Restaurant</label>
                    <select id="restaurant" class="styled-select">
                        <option value="all">All</option>
                        <option value="Kachiguda Junction">Kachiguda Junction</option>
                        <option value="Raja Chettinad">Raja Chettinad</option>
                        <option value="Sardar Ji">Sardar Ji</option>
                        <option value="Mannas Food">Manna's Food</option>
                    </select>
                </div>
            </div>
        </div>
    </div>
    

    
    
    
    
    <!-- Product List Section for Search Results -->
    
    <div id="searchResults" class="product-list">
        <div id="productList"></div> <!-- Results will be displayed here -->
    
    </div>
    <!-- JavaScript for Search -->
    <script>
        // Utility function to get query parameters from the URL
    function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }
    
        // Populate the search field and trigger the search on page load
    window.onload = function () {
            const searchTerm = getQueryParam('term');
            const searchInput = document.getElementById('search-term');
    
            if (searchTerm) {
                searchInput.value = decodeURIComponent(searchTerm); // Set the search term in the input field
                searchFood(); // Automatically search for the term
            }
        };
        async function searchFood(event) {
    if (event) event.preventDefault(); // Prevent form submission (if triggered by button)

    const searchTerm = document.getElementById('search-term').value.trim();
    if (!searchTerm) {
        alert("Please enter a search input");
        return;
    }

    // Save the search term to localStorage
    saveSearchHistory(searchTerm);

    try {
        const response = await fetch(`http://localhost:3000/search?term=${encodeURIComponent(searchTerm)}`);
        if (!response.ok) {
            throw new Error('Network response was not ok: ' + response.statusText);
        }
        const data = await response.json();

        renderItems(data); // Render items dynamically
    } catch (error) {
        console.error('Error:', error);
        document.getElementById("productList").innerHTML = "<p>Error fetching data. Please try again later.</p>";
    }
}

// Save search term in localStorage
function saveSearchHistory(term) {
    let searchHistory = JSON.parse(localStorage.getItem("searchHistory")) || [];
    if (!searchHistory.includes(term)) {
        searchHistory.push(term);
    }

    // Limit the search history to the last 10 terms
    if (searchHistory.length > 10) {
        searchHistory.shift(); // Remove the oldest entry
    }

    localStorage.setItem("searchHistory", JSON.stringify(searchHistory));
}



function renderItems(items) {
    const productList = document.getElementById("productList");
    const sortBy = document.getElementById("sort-by").value;
    const selectedRestaurant = document.getElementById("restaurant").value;

    // Get price range inputs
    const minPrice = parseFloat(document.getElementById("min-price").value) || 0;
    const maxPrice = parseFloat(document.getElementById("max-price").value) || Infinity;

    // Filter by restaurant and price range
    let filteredItems = items.filter(item => {
        const itemPrice = parseFloat(item.cost) || 0;
        const restaurantMatch = selectedRestaurant === 'all' || item.Restaurant_Name.toLowerCase() === selectedRestaurant.toLowerCase();
        const priceMatch = itemPrice >= minPrice && itemPrice <= maxPrice;
        return restaurantMatch && priceMatch;
    });

    // Sort the filtered items by price
    filteredItems.sort((a, b) => {
        if (sortBy === "low-to-high") {
            return a.cost - b.cost;
        } else {
            return b.cost - a.cost;
        }
    });

    productList.innerHTML = ''; // Clear the list

    if (filteredItems.length > 0) {
        filteredItems.forEach(item => {
            const itemName = item.item_name || 'No Name';
            const itemDescription = item.item_description || 'No description available';
            const itemPrice = item.cost || 'N/A';
            const restaurantName = item.Restaurant_Name || 'Unknown';
            const restaurantLink = item.restaurant_link || '#'; // Default to '#' if no link available

            const productCard = document.createElement("div");
            productCard.classList.add("card", "dark");
            productCard.innerHTML = `
                <div class="card-body" style="width: 920px; height: 160px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);">
                    <div class="text-section" style="flex: 1; margin-right: 10px;">
                        <h5 class="card-title fw-bold" style="margin: 0; font-size: 18px;">${itemName}</h5>
                        <p class="card-text truncated-description" 
                            style="margin: 5px 0; font-size: 14px; color: #666; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; cursor: pointer;" 
                            title="${itemDescription}">
                            ${itemDescription}
                        </p>
                        <p class="card-text" style="margin: 5px 0; font-size: 14px;">
                            <strong>Restaurant:</strong> <a href="${restaurantLink}" target="_blank" style="color: #007bff; text-decoration: none;">${restaurantName}</a>
                        </p>
                    </div>
                    <div class="cta-section" style="position: absolute; top: 23px; right: 10px; cursor: pointer; font-size: 16px;">
                         <a href="#" class="btn btn-success" style="padding: 10px 20px; font-size: 16px; border-radius: 5px;">$${itemPrice}</a>
                    </div>
                    <div class="cta-section" style="position: absolute; bottom: 10px; right: 10px; cursor: pointer; font-size: 20px;">
                        <a href="javascript:void(0);" class="favorite-btn" style="color: #ff5733;" onclick="toggleFavorite(event, '${itemName}', '${itemDescription}', '${itemPrice}', '${restaurantName}', '${restaurantLink}')">
                        <i class="far fa-heart" id="heart-icon${itemName}"></i> </a>
                       
                    </div>


                </div>
            `;
            productList.appendChild(productCard);
        });
    } else {
        productList.innerHTML = "<p>No results found</p>";
    }
}

</script>
<script>
    // Function to toggle the favorite state
    function toggleFavorite(event, itemName, itemDescription, itemPrice, restaurantName, restaurantLink) {
        const heartIcon = event.target.closest('.favorite-btn').querySelector('i');
        const isFavorite = heartIcon.classList.contains('fas'); // Check if heart is filled

        // If the heart is filled (favorite), remove it from localStorage
        if (isFavorite) {
            // Remove from localStorage
            let favorites = JSON.parse(localStorage.getItem("favorites")) || [];
            favorites = favorites.filter(item => item.itemName !== itemName); // Remove the product by name
            localStorage.setItem("favorites", JSON.stringify(favorites));

            // Change icon back to unfilled
            heartIcon.classList.remove('fas');
            heartIcon.classList.add('far');
        } else {
            // If it's not filled, add to localStorage
            const favoriteItem = {
                itemName,
                itemDescription,
                itemPrice,
                restaurantName,
                restaurantLink
            };

            let favorites = JSON.parse(localStorage.getItem("favorites")) || [];
            favorites.push(favoriteItem); // Add new favorite
            localStorage.setItem("favorites", JSON.stringify(favorites));

            // Change icon to filled
            heartIcon.classList.remove('far');
            heartIcon.classList.add('fas');
        }
    }

    // Function to load and display favorite products on the favorites page (favorite.html or searchhistory.html)
    function loadFavorites() {
        const recentlyViewedContainer = document.getElementById("recentlyViewedContainer");
        const favorites = JSON.parse(localStorage.getItem("favorites")) || [];

        if (favorites.length === 0) {
            recentlyViewedContainer.innerHTML = "<p>No favorite products yet.</p>";
        } else {
            favorites.forEach(favorite => {
                const productCard = document.createElement("div");
                productCard.classList.add("card", "dark");
                productCard.innerHTML = `
                    <div class="card-body" style="display: flex; justify-content: space-between; align-items: center; border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);">
                        <div class="text-section" style="flex: 1; margin-right: 10px;">
                            <h5 class="card-title fw-bold">${favorite.itemName}</h5>
                            <p class="card-text">${favorite.itemDescription}</p>
                            <p class="card-text"><strong>Restaurant:</strong> <a href="${favorite.restaurantLink}" target="_blank">${favorite.restaurantName}</a></p>
                            <p class="card-text"><strong>Price:</strong> $${favorite.itemPrice}</p>
                        </div>
                    </div>
                `;
                recentlyViewedContainer.appendChild(productCard);
            });
        }
    }

    // Call this function when the page loads to display the favorites
    document.addEventListener("DOMContentLoaded", loadFavorites);
</script>

    
    
</body>

</html>





